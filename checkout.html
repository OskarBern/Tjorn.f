<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Checkout â€” TJÃ–RN FINESSE</title>

<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<script src="https://www.paypal.com/sdk/js?client-id=Ab6WK-fso-KfHgXawTi0w_-NIM2RspXwTdWPRieCBu2DeckX-s222TcBorwUSY96BOvtdAwIfnhO2IDX&currency=SEK"></script>

<style>
:root{
  --accent:#c62828;
  --muted:#9aa0a6;
  --bg:#0f0f10;
  --card:#0f1112;
  --text:#fff;
  --box:#111;
}
html,body{height:100%;margin:0;font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b0b0b;color:var(--text)}
.container{max-width:1100px;margin:28px auto;padding:20px}
.header{display:flex;align-items:center;gap:20px;margin-bottom:18px}
.logo{font-family:Oswald,sans-serif;font-weight:700;color:#fff;font-size:20px;text-decoration:none}
.layout{display:grid;grid-template-columns:1fr 420px;gap:28px}
@media (max-width:940px){ .layout{grid-template-columns:1fr;padding:0 10px} }
.card{background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(0,0,0,0.6)}
h1{font-family:Oswald;margin:0 0 8px;font-size:28px}
h2{margin:0 0 12px;font-size:16px}
label{display:block;margin-top:12px;color:var(--muted);font-size:13px}
input[type="text"], textarea, select { width:100%; padding:10px 12px; margin-top:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:#0b0b0b; color:var(--text); box-sizing:border-box; font-size:15px }
textarea{min-height:90px; resize:vertical}
.small{font-size:13px;color:var(--muted)}
.btn{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:700;cursor:pointer;margin-top:12px}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
.cart-list{display:flex;flex-direction:column;gap:10px;margin-bottom:8px}
.cart-item{display:flex;gap:12px;align-items:center;padding:10px;border-radius:10px;background:#0b0c0d;border:1px solid rgba(255,255,255,0.02)}
.thumb{width:64px;height:64px;border-radius:8px;background:#111;display:flex;align-items:center;justify-content:center;color:#777}
.meta{flex:1}
.title{font-weight:700}
.opt{color:var(--muted);font-size:13px;margin-top:4px}
.price{margin-top:8px;font-weight:700}
.total-row{display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px dashed rgba(255,255,255,0.03);margin-top:12px}
#paypal-button-container { margin-top: 20px; min-height: 150px; }
.hidden { display: none !important; }
</style>
</head>
<body>

<div class="container">
  <header class="header">
    <a class="logo" href="index.html">TJÃ–RN FINESSE</a>
  </header>

  <div class="layout">
    <section class="card">
      <h1>Checkout</h1>
      <p class="small">Fill in your details. Shipping and fees are added automatically.</p>

      <h2>Contact & Shipping</h2>

      <label for="name">Full name</label>
      <input id="name" type="text" placeholder="Marcus">

      <label for="address">Street & number</label>
      <input id="address" type="text" placeholder="Street 12">

      <label for="zip">ZIP / Postal code</label>
      <input id="zip" type="text" placeholder="40210" inputmode="numeric">

      <label for="country">Country</label>
      <select id="country">
        <option value="sweden">Sweden (20 SEK)</option>
        <option value="germany">Germany (15 SEK)</option>
        <option value="eu">EU (25 SEK)</option>
        <option value="outside">Outside EU (35 SEK)</option>
      </select>

      <div style="display:flex;gap:10px;margin-top:14px;align-items:center;">
        <button id="prepare" class="btn">Confirm Details</button>
        <button id="clear" class="btn ghost">Clear Cart</button>
      </div>

      <div id="paypal-section" class="hidden">
        <h2 style="margin-top:25px">Secure Payment</h2>
        <p class="small">Pay via PayPal or Credit Card</p>
        <div id="paypal-button-container"></div>
      </div>
    </section>

    <aside class="card">
      <h2>Your Order</h2>
      <div id="cartList" class="cart-list small"></div>

      <div class="total-row">
        <div class="small">Shipping</div>
        <div id="shippingCost" style="font-weight:800">0.00 SEK</div>
      </div>

      <div class="total-row" style="border-top: none; padding-top: 4px;">
        <div class="small">Processing Fee</div>
        <div id="processingFee" style="font-weight:800">10.00 SEK</div>
      </div>

      <div class="total-row" style="margin-top:8px">
        <div class="small">Total</div>
        <div id="totalCost" style="font-weight:900; font-size: 20px; color: var(--accent);">0.00 SEK</div>
      </div>

      <div style="margin-top:20px; padding:15px; background:#0b0b0b; border-radius:8px; border:1px solid rgba(255,255,255,0.05)">
          <div class="small">Order Note (Description)</div>
          <textarea id="paymentMessage" readonly style="font-size: 12px; color:#777;"></textarea>
      </div>
    </aside>
  </div>
</div>

<script>
/* --- CONFIG --- */
const FLAT_PROCESSING_FEE = 10.00; // You can change this amount here

/* --- HELPERS --- */
function safeNum(v){ const n = Number(v); return Number.isFinite(n) ? n : 0; }
function fmtSEK(n){ return n.toFixed(2) + " SEK"; }
function el(id){ return document.getElementById(id); }

function getPriceBasedDescription(price, currentSize) {
    const p = safeNum(price);
    if (p === 110) return "big 15cm";
    if (p === 120) return "small 9cm";
    return currentSize || "Standard";
}

/* --- CART LOAD & RENDER --- */
function readCart(){ 
  try { return JSON.parse(localStorage.getItem("cart") || "[]"); }
  catch(e){ return []; }
}

function renderCart(){
  const cart = readCart();
  const list = el("cartList");
  list.innerHTML = "";

  if(!cart.length){
    list.innerHTML = "<div class='small'>Your cart is empty.</div>";
    el("totalCost").textContent = "0.00 SEK";
    return;
  }

  let total = 0;
  cart.forEach(item => {
    const price = safeNum(item.price);
    const qty = Math.max(1, safeNum(item.quantity));
    const displaySize = getPriceBasedDescription(price, item.size);
    total += price * qty;

    const row = document.createElement("div");
    row.className = "cart-item";
    row.innerHTML = `
      <div class="thumb">ðŸŽ£</div>
      <div class="meta">
        <div class="title">${item.name}</div>
        <div class="opt">${displaySize}</div>
        <div class="price">${price.toFixed(2)} SEK Ã— ${qty}</div>
      </div>
    `;
    list.appendChild(row);
  });

  el("cartList").dataset.baseTotal = total.toFixed(2);
  updateTotals();
}

function getShippingFor(c){
  switch(c){
    case "sweden": return 20;
    case "germany": return 15;
    case "eu": return 25;
    case "outside": return 35;
    default: return 0;
  }
}

function updateTotals(){
  const base = Number(el("cartList").dataset.baseTotal) || 0;
  const shipping = getShippingFor(el("country").value);
  
  // Math: Items + Shipping + Fee
  const total = base + shipping + FLAT_PROCESSING_FEE;

  el("shippingCost").textContent = fmtSEK(shipping);
  el("processingFee").textContent = fmtSEK(FLAT_PROCESSING_FEE);
  el("totalCost").textContent = fmtSEK(total);
  
  const cart = readCart();
  const itemsDesc = cart.map(i => `${i.name} (${getPriceBasedDescription(i.price, i.size)}) x${i.quantity}`).join(", ");
  el("paymentMessage").value = `Shipping to: ${el("name").value || '...'} | Items: ${itemsDesc} | Includes ${FLAT_PROCESSING_FEE} SEK fee`;
  el("paymentMessage").dataset.amount = total.toFixed(2);
}

/* --- PAYPAL INTEGRATION --- */
function initPayPal() {
    paypal.Buttons({
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    description: el("paymentMessage").value,
                    amount: {
                        currency_code: 'SEK',
                        value: el("paymentMessage").dataset.amount
                    }
                }]
            });
        },
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                localStorage.removeItem("cart");
                window.location.href = "success.html";
            });
        },
        onError: function(err) {
            alert("Payment failed or was cancelled. Please check your details.");
            console.error(err);
        }
    }).render('#paypal-button-container');
}

/* --- BUTTON EVENTS --- */
el("prepare").addEventListener("click", ()=>{
  if(!el("name").value.trim() || !el("address").value.trim()){
    alert("Please enter shipping name and address first.");
    return;
  }
  updateTotals();
  el("paypal-section").classList.remove("hidden");
  el("prepare").innerText = "Details Confirmed âœ“";
  el("prepare").disabled = true;
  initPayPal();
});

el("country").addEventListener("change", updateTotals);

el("clear").addEventListener("click", ()=>{
  if(confirm("Clear cart?")){
    localStorage.removeItem("cart");
    location.reload();
  }
});

/* --- INIT --- */
renderCart();
</script>

</body>
</html>
