<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Checkout â€” TJÃ–RN FINESSE</title>

<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --accent:#c62828;
  --muted:#9aa0a6;
  --bg:#0f0f10;
  --card:#0f0f10;
  --text:#fff;
  --box:#111;
}
html,body{height:100%;margin:0;font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b0b0b;color:var(--text)}
.container{max-width:1100px;margin:28px auto;padding:20px}
.header{display:flex;align-items:center;gap:20px;margin-bottom:18px}
.logo{font-family:Oswald,sans-serif;font-weight:700;color:#fff;font-size:20px;text-decoration:none}
.layout{display:grid;grid-template-columns:1fr 420px;gap:28px}
@media (max-width:940px){ .layout{grid-template-columns:1fr;padding:0 10px} }
.card{background:#0f1112;border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(0,0,0,0.6)}
h1{font-family:Oswald;margin:0 0 8px;font-size:28px}
h2{margin:0 0 12px;font-size:16px}
label{display:block;margin-top:12px;color:var(--muted);font-size:13px}
input[type="text"], textarea, select { width:100%; padding:10px 12px; margin-top:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:#0b0b0b; color:var(--text); box-sizing:border-box; font-size:15px }
textarea{min-height:90px; resize:vertical}
.small{font-size:13px;color:var(--muted)}
.btn{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:700;cursor:pointer;margin-top:12px}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
.copy-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.cart-list{display:flex;flex-direction:column;gap:10px;margin-bottom:8px}
.cart-item{display:flex;gap:12px;align-items:center;padding:10px;border-radius:10px;background:#0b0c0d;border:1px solid rgba(255,255,255,0.02)}
.thumb{width:64px;height:64px;border-radius:8px;background:#111;display:flex;align-items:center;justify-content:center;color:#777}
.meta{flex:1}
.title{font-weight:700}
.opt{color:var(--muted);font-size:13px;margin-top:4px}
.price{margin-top:8px;font-weight:700}
.total-row{display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px dashed rgba(255,255,255,0.03);margin-top:12px}
.notice{margin-top:12px;color:var(--muted);font-size:13px}
.confirm{background:#09331b;color:#bff0cb;padding:10px;border-radius:8px;margin-top:12px;display:none}
.footer-note{margin-top:14px;font-size:13px;color:var(--muted)}
.link{color:#fff;text-decoration:underline}
</style>
</head>
<body>

<div class="container">
  <header class="header">
    <a class="logo" href="index.html">TJÃ–RN FINESSE</a>
  </header>

  <div class="layout">

    <!-- LEFT: Customer details -->
    <section class="card">
      <h1>Checkout</h1>
      <p class="small">Fill in your details. We compute shipping automatically based on ZIP & country.</p>

      <h2>Contact & Shipping</h2>

      <label for="name">Full name</label>
      <input id="name" type="text" placeholder="Marcus">

      <label for="address">Street & number</label>
      <input id="address" type="text" placeholder="Street 12">

      <label for="zip">ZIP / Postal code</label>
      <input id="zip" type="text" placeholder="40210" inputmode="numeric">

      <label for="country">Country</label>
      <select id="country">
        <option value="sweden">Sweden</option>
        <option value="germany">Germany</option>
        <option value="eu">EU (other)</option>
        <option value="outside">Outside EU</option>
      </select>

      <div style="display:flex;gap:10px;margin-top:14px;align-items:center;">
        <button id="prepare" class="btn">Prepare Payment</button>
        <button id="clear" class="btn ghost">Clear Cart</button>
      </div>

      <div id="status" class="confirm" role="status"></div>
      <p class="footer-note">After preparing, tap <strong>Open Swish</strong> on your phone or copy the amount & message to paste into Swish.</p>
    </section>

    <!-- RIGHT: Order summary & Swish actions -->
    <aside class="card">
      <h2>Your Order</h2>

      <div id="cartList" class="cart-list small"></div>

      <div class="total-row">
        <div class="small">Shipping</div>
        <div id="shippingCost" style="font-weight:800">0.00 SEK</div>
      </div>

      <div class="total-row" style="margin-top:8px">
        <div class="small">Total</div>
        <div id="totalCost" style="font-weight:900">0.00 SEK</div>
      </div>

      <div style="margin-top:14px">
        <div class="small">Pay to Swish number</div>
        <div style="font-weight:800;margin-top:6px">+49 15223541838</div>
        <div class="notice">Deep link works on mobile (attempts to open the Swish app). Desktop users should copy amount & message manually.</div>
                    <img src="Image.heic" alt="SkÃ¤rgÃ¥rd Shiny Red Lure Main View">

        <div class="copy-row">
          <button id="copyAmount" class="btn ghost">Copy amount</button>
          <button id="copyMessage" class="btn">Copy payment message</button>
          <button id="openSwish" class="btn">Open Swish (mobile)</button>
        </div>

        <div style="margin-top:12px">
          <div class="small">Payment message (MANDATORY NEEDS TO BE ADDED TO PAYMENT MESSAGE!)</div>
          <textarea id="paymentMessage" readonly style="width:100%;height:110px;margin-top:8px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:var(--text);padding:10px"></textarea>
        </div>

        <div id="paidConfirm" class="confirm" style="display:none">Marked as paid locally. If you received a Swish receipt, keep it and contact support if needed.</div>
      </div>
    </aside>

  </div>
</div>

<script>
/* ---------------------------
  Configuration
----------------------------*/
const SWISH_NUMBER = "+49 15223541838"; // your number (display only)
const SWISH_NUMBER_FOR_LINK = "+4915223541838"; // no spaces for deep link payload

/* ---------------------------
  Utilities
----------------------------*/
function safeNum(v){ const n = Number(v); return Number.isFinite(n) ? n : 0; }
function fmtSEK(n){ return n.toFixed(2) + " SEK"; }
function el(id){ return document.getElementById(id); }

/* ---------------------------
  Read cart and render
  Expects cart items with:
  { name, size, price, quantity, image? }
----------------------------*/
function readCart(){ 
  try { return JSON.parse(localStorage.getItem("cart") || "[]"); }
  catch(e){ return []; }
}

function renderCart(){
  const cart = readCart();
  const list = el("cartList");
  list.innerHTML = "";
  if(!cart.length){ list.innerHTML = "<div class='small'>Your cart is empty.</div>"; el("shippingCost").textContent = "0.00 SEK"; el("totalCost").textContent = "0.00 SEK"; el("paymentMessage").value = ""; return; }

  let total = 0;
  cart.forEach(item => {
    const price = safeNum(item.price);
    const qty = Math.max(1, safeNum(item.quantity));
    const size = item.size || item.option || "";
    const line = price * qty;
    total += line;

    const row = document.createElement("div");
    row.className = "cart-item";
    row.innerHTML = `
      <div class="thumb">ðŸŽ£</div>
      <div class="meta">
        <div class="title">${escapeHtml(item.name || "Product")}</div>
        <div class="opt">${escapeHtml(size)}</div>
        <div class="price">${price.toFixed(2)} SEK Ã— ${qty}</div>
      </div>
    `;
    list.appendChild(row);
  });

  // store base total for later
  el("cartList").dataset.baseTotal = total.toFixed(2);
  // initial totals
  updateTotals();
}

/* ---------------------------
  Shipping rules
----------------------------*/
function getShippingFor(countryValue){
  switch((countryValue||"").toLowerCase()){
    case "sweden": return 0;
    case "germany": return 15;
    case "eu": return 25;
    case "outside": return 35;
    default: return 35;
  }
}

/* ---------------------------
  Build payment message in the requested format:
  "Shiny Red (Small) x2, Fireline (Large) x1 â€” Name: Marcus â€” Address: Street 12, 40210 DÃ¼sseldorf"
----------------------------*/
function buildPaymentMessage(){
  const cart = readCart();
  const name = el("name").value.trim() || "[Name]";
  const address = el("address").value.trim() || "[Address]";
  let parts = [];

  cart.forEach(item => {
    const qty = Math.max(1, safeNum(item.quantity));
    const size = item.size || item.option || "";
    const sizeFragment = size ? ` (${size})` : "";
    parts.push(`${escapeHtml(item.name)}${sizeFragment} x${qty}`);
  });

  // join with commas, then long dash and details
  const prodPart = parts.join(", ");
  const message = `${prodPart} â€” Name: ${name} â€” Address: ${address}`;
  return message;
}

/* ---------------------------
  Totals & updating
----------------------------*/
function updateTotals(){
  const base = Number(el("cartList").dataset.baseTotal) || 0;
  const country = el("country").value;
  const shipping = getShippingFor(country);
  const total = base + shipping;

  el("shippingCost").textContent = fmtSEK(shipping);
  el("totalCost").textContent = fmtSEK(total);

  // update preview message and amount stored
  el("paymentMessage").value = buildPaymentMessage();
  el("paymentMessage").dataset.amount = total.toFixed(2);
}

/* ---------------------------
  Escape html
----------------------------*/
function escapeHtml(str){
  if(typeof str !== "string") return str;
  return str.replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); });
}

/* ---------------------------
  Copy helpers
----------------------------*/
function copyText(text){
  return navigator.clipboard.writeText(text);
}

/* ---------------------------
  Deep link builder + open attempt
  We build a JSON payload and try to open swish://payment?data=<encoded JSON>
  This works on many mobile devices. We also provide manual copy fallback.
----------------------------*/
function buildSwishDeepLink(amountNumber, message){
  // amountNumber should be number (e.g. 123.45)
  const payloadObj = {
    version: 1,
    payee: {value: SWISH_NUMBER_FOR_LINK},
    amount: Number(amountNumber),
    message: message
  };
  const json = JSON.stringify(payloadObj);
  // encodeURIComponent and build link
  return "swish://payment?data=" + encodeURIComponent(json);
}

function tryOpenSwish(){
  const amount = el("paymentMessage").dataset.amount || el("totalCost").textContent.replace(" SEK","") || "0.00";
  const message = el("paymentMessage").value || "";
  const deep = buildSwishDeepLink(amount, message);

  // attempt to open (mobile). This will either open Swish or do nothing.
  window.location.href = deep;

  // As progressive enhancement also open a fallback page after a short delay? We won't redirect.
}

/* ---------------------------
  Event wiring
----------------------------*/
document.getElementById("country").addEventListener("change", function(){
  updateTotals();
});

el("zip").addEventListener("input", function(){
  // No complex geo lookup â€” user chooses country themselves; we still update
  // You could add auto-detection by ZIP with an API in the future.
  updateTotals();
});

el("name").addEventListener("input", updateTotals);
el("address").addEventListener("input", updateTotals);

document.getElementById("copyAmount").addEventListener("click", function(){
  const amount = el("paymentMessage").dataset.amount || el("totalCost").textContent.replace(" SEK","") || "0.00";
  copyText(amount).then(()=> { alert("Amount copied: " + amount + " SEK"); }, ()=> { alert("Couldn't copy automatically, select and copy manually."); });
});

document.getElementById("copyMessage").addEventListener("click", function(){
  const msg = el("paymentMessage").value || "";
  copyText(msg).then(()=> { alert("Payment message copied. Paste it in Swish."); }, ()=> { alert("Couldn't copy automatically, select and copy manually."); });
});

document.getElementById("openSwish").addEventListener("click", function(e){
  // ensure required fields are present
  const name = el("name").value.trim();
  const address = el("address").value.trim();
  if(!name || !address){
    alert("Please enter your name and address before opening Swish.");
    return;
  }
  tryOpenSwish();
});

document.getElementById("prepare").addEventListener("click", function(){
  const name = el("name").value.trim();
  const address = el("address").value.trim();
  if(!name || !address){
    alert("Please enter your name and address before preparing payment.");
    return;
  }
  updateTotals();
  el("status").style.display = "block";
  el("status").textContent = "Payment prepared. Copy the amount and message or open Swish on your phone.";
  setTimeout(()=> el("status").style.display = "none", 8000);
});

document.getElementById("clear").addEventListener("click", function(){
  if(!confirm("Clear cart? This removes cart items stored in your browser.")) return;
  localStorage.removeItem("cart");
  renderCart();
  updateTotals();
  el("status").style.display = "block";
  el("status").textContent = "Cart cleared.";
  setTimeout(()=> el("status").style.display = "none", 4000);
});

/* paid button â€” marking as paid locally (non-authoritative) */
document.getElementById("openSwish").addEventListener("dblclick", function(){
  // double-click opens and then shows confirmation prompt â€” optional behaviour
});

/* ---------------------------
  Init
----------------------------*/
renderCart();
updateTotals();
</script>

</body>
</html>
